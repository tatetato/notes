<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Curriculum</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Yuji+Syuku&display=swap" rel="stylesheet">
  <style>
    html {
      width: 100vw;
      overflow-x: hidden;
    }
    
    .teacher-name {
       font-family: "Yuji Syuku", serif;
    }

    .table {
      min-width: 800px;
    }

    .table-row {
      display: grid;
      grid-template-columns: 6rem 3rem repeat(5, 1fr);
    }

    .period-box {
      display: grid;
      grid-template-rows: repeat(auto-fill, 1fr);
    }

    .period-header {
      background-color: #d3d3d3;
      font-size: 22px;
      text-align: center;
    }

    .table-cell {
      border: 1px solid gray;
    }

    .period-cell {
      border: 1px solid gray;
      min-height: 6rem;
    }

    .time-box {
      display: grid;
      grid-template-rows: repeat(auto-fill, 1fr);
      text-align: center;
    }

    .time-cell {
      min-height: 2rem;
    }

    .floor-number {
      text-align: center;
      font-size: 3rem;
      color: rgb(53, 15, 124);
      font-family: Impact, Haettenschweiler, "Arial Narrow Bold", sans-serif;
    }

    .highlight {
      background-color: rgb(255, 241, 116);
    }

    .indicator {
      height: 2px;
      background-color:  rgba(255, 24, 24, 0.856);
      position: absolute;

      /*   not working on android firefox */
      /* width: 100vw; */

      top: 0;
      transition: all ease 0.3s;
    }

    .indicator-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      color: rgb(6, 179, 57);
    }

    .text-center {
      text-align: center;
    }

    .relative {
      position: relative;
    }

    .py-1 {
      padding-top: 1rem;
      padding-bottom: 1rem;
    }

    .py-2 {
      padding-top: 2rem;
      padding-bottom: 2rem;
    }
  </style>
</head>

<body>
  <div class="table">
    <div class="table-header">
      <div class="table-row">
        <div class="table-cell"></div>
        <div class="table-cell"></div>
        <div id="weekdayContainer"></div>
      </div>
    </div>
    <div class="table-body">
      <div class="table-row">
        <div class="table-cell" id="time-box-1"></div>
        <div class="table-cell period-header"></div>
        <div class="table-cell">
          <div class="period-box">
            <div class="period-cell">
              Web デザイン I
            </div>
            <div class="period-cell teacher-name">
              岩本
            </div>
            <div class="period-cell floor-number">
              43
            </div>
          </div>
        </div>
        <div class="table-cell">
          <div class="period-box">
            <div class="period-cell">
              英語 I
            </div>
            <div class="period-cell">
              トベ　サラミ
            </div>
            <div class="period-cell floor-number">
              21
            </div>
          </div>
        </div>
        <div class="table-cell">
          <div class="period-box">
            <div class="period-cell">
              ネットワーク I
            </div>
            <div class="period-cell">
              深田
            </div>
            <div class="period-cell floor-number">
              24
            </div>
            <!-- classroom で出席確認必要
            教科書の point は試験の時出るかもしれません -->
          </div>
        </div>
        <div class="table-cell">
          <div class="period-box">
            <div class="period-cell">
              ビジネス日本語練習 I
            </div>
            <div class="period-cell">
              吉田
            </div>
            <div class="period-cell floor-number">
              21
            </div>
          </div>
        </div>
        <div class="table-cell">
          <div class="period-box">
            <div class="period-cell">
              プログラミング I
            </div>
            <div class="period-cell">
              根岸
            </div>
            <div class="period-cell floor-number">
              61
            </div>
          </div>
        </div>
      </div>
      <div class="table-row">
        <div class="table-cell" id="time-box-2"></div>
        <div class="table-cell period-header"></div>
        <div class="table-cell">
          <div class="period-box">
            <div class="period-cell">
              Web デザイン I
            </div>
            <div class="period-cell">
              岩本
            </div>
            <div class="period-cell floor-number">
              43
            </div>
          </div>
        </div>
        <div class="table-cell">
          <div class="period-box">
            <div class="period-cell">
              ビジネスソフト I A (Excel)
            </div>
            <div class="period-cell">
              森（烈）
            </div>
            <div class="period-cell floor-number">
              61
            </div>
          </div>
        </div>
        <div class="table-cell">
          <div class="period-box">
            <div class="period-cell">
              ビジネスソフト I B (Word)
            </div>
            <div class="period-cell">
              伊藤
            </div>
            <div class="period-cell floor-number">
              24
            </div>
          </div>
        </div>
        <div class="table-cell">
          <div class="period-box">
            <div class="period-cell">
              コンピューターシステム I
            </div>
            <div class="period-cell">
              山崎
            </div>
            <div class="period-cell floor-number">
              31
            </div>
          </div>
        </div>
        <div class="table-cell">
          <div class="period-box">
            <div class="period-cell">
              プログラミング I
            </div>
            <div class="period-cell">
              根岸
            </div>
            <div class="period-cell floor-number">
              61
            </div>
          </div>
        </div>
      </div>
      <div class="table-row">
        <div class="table-cell" id="time-box-3"></div>
        <div class="table-cell period-header"></div>
        <div class="table-cell">
          <div class="period-box">
            <div class="period-cell">
              ビジネス日本語 I
            </div>
            <div class="period-cell">
              澤田
            </div>
            <div class="period-cell floor-number">
              41
            </div>
          </div>
        </div>
        <div class="table-cell">
          <div class="period-box">
            <div class="period-cell">
              ビジネス基礎 I
            </div>
            <div class="period-cell">
              森（大）
            </div>
            <div class="period-cell floor-number">
              21
            </div>
          </div>
        </div>
        <div class="table-cell">
          <div class="period-box">
            <div class="period-cell">
              12:35~13:00 HR
            </div>
            <div class="period-cell">
              担任
            </div>
            <div class="period-cell floor-number">
              24
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- https://releases.jquery.com/ -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script>
    $(document).ready(function () {



      function createPeriodHeader(time) {
        let $periodHeader = $(` 
          <div class="period-box ">
            <div class="period-cell" style="">
              科目 📚 
            </div>
            <div class="period-cell">
              先生 👩‍🏫
            </div>
            <div class="period-cell">
              教室 🏫
            </div>
          </div>
            `);

        return $periodHeader;
      }

      $.each($(".period-header"), function (index, item) {
        let $periodHeader = createPeriodHeader();
        $(item).append($periodHeader);
      });

      // let weekdays = ["日", "月", "火", "水", "木", "金", "土"];

      let courses = [
  {
    id: 0,
    subject: "Web デザイン I",
    teacher: "岩本",
    classroom: "43"
  },
  {
    id: 1,
    subject: "英語 I",
    teacher: "トベ　サラミ",
    classroom: "21"
  },]

  let periods = [
  {
    id: 0,
    startTime: "9:20",
    endTime: "10:50"
  },
  {
    id: 1,
    startTime: "11:05",
    endTime: "12:35"
  },
  {
    id: 2,
    startTime: "13:25",
    endTime: "14:55"
  },]

let weekdays = [
  { id: 0, japanese: "日", english: "Sunday" },
  { id: 1, japanese: "月", english: "Monday" },
  { id: 2, japanese: "火", english: "Tuesday" },
  { id: 3, japanese: "水", english: "Wednesday" },
  { id: 4, japanese: "木", english: "Thursday" },
  { id: 5, japanese: "金", english: "Friday" },
  { id: 6, japanese: "土", english: "Saturday" }
];


      function createWeekday(weekday) {
        let $weekday = $("<div></div>")
          .text(weekday.japanese)
          .addClass(["table-cell", "text-center", "py-1"]);

        let today = new Date().getDay();

        if (weekday.japanese === weekdays[today].japanese) {
          $weekday.addClass("highlight");
        }

        return $weekday;
      }

      $.each(weekdays.slice(1, 6), function (index, weekday) {
        let $weekday = createWeekday(weekday);
        $("#weekdayContainer").append($weekday);
      });

      setTimeout(() => {
        // wait for all the weekdays
        // how to resolve this async problem in jquery
        $("#weekdayContainer")
          .children()
          .unwrap();
      });

      let courseTimeObjects = [
        {
          index: 0,
          startTime: "9:20",
          endTime: "10:50"
        },
        {
          index: 1,
          startTime: "11:05",
          endTime: "12:35"
        },
        {
          index: 2,
          startTime: "13:25",
          endTime: "14:55"
        }
      ];

      function compareWithCurrentTime(timeObject) {
        const currentTime = new Date();
        const startTime = new Date();
        const endTime = new Date();

        const [startHours, startMinutes] = timeObject.startTime.split(":");
        startTime.setHours(startHours);
        startTime.setMinutes(startMinutes);

        const [endHours, endMinutes] = timeObject.endTime.split(":");
        endTime.setHours(endHours);
        endTime.setMinutes(endMinutes);

        let deltaStartPercent = -1;
        let result = currentTime > startTime && currentTime < endTime;

        if (result) {
          deltaStartPercent =
            ((currentTime - startTime) / (endTime - startTime)) * 100;
        }

        return { result, deltaStartPercent };
      }

      function createCourseTime(time) {
        let $courseTime = $(` 
            <div class="time-box">
            <div class="time-cell">
              ${time.index + 1}限
            </div>
            <div class="time-cell">
              ${time.startTime}
            </div>
            <div class="time-cell">
              ~
            </div>
            <div class="time-cell">
                ${time.endTime}
            </div>
            </div>`);

        return $courseTime;
      }

      $.each(courseTimeObjects, function (index, time) {
        let $courseTime = createCourseTime(time);
        $(`#time-box-${time.index + 1}`).append($courseTime);
      });

      $.each(courseTimeObjects, function (index, time) {
        const compared = compareWithCurrentTime(time);

        if (compared.result) {
          let $timeBox = $(`#time-box-${time.index + 1}`);

          $timeBox.addClass("highlight").addClass("relative");

          let nowHours = (new Date()).getHours() 
          let nowMinutes = (new Date()).getMinutes();
          let $indicator = $(`<div class='indicator'><div class="indicator-text">${nowHours}:${nowMinutes}</div></div>`).css(
            "top",
            `${compared.deltaStartPercent}%`
          );
          $timeBox.append($indicator);
          updateIndicatorWidth();
        }
      });

      $(window).on("focus", function () {
        $.each(courseTimeObjects, function (index, time) {
          let $timeBox = $(`#time-box-${time.index + 1}`);
          $timeBox.removeClass("highlight");
          // $timeBox.children().remove("indicator");

          const compared = compareWithCurrentTime(time);

          if (compared.result) {
            $timeBox.addClass("highlight").addClass("relative");

            let nowHours = (new Date()).getHours() 
          let nowMinutes = (new Date()).getMinutes();
          let $indicator = $(`<div class='indicator'><div class="indicator-text">${nowHours}:${nowMinutes}</div></div>`).css(
            "top",
            `${compared.deltaStartPercent}%`
          );
          $timeBox.append($indicator);
          updateIndicatorWidth();
          }
        });
      });

      // Function to update the width of the indicator to match the width of the .table div
      function updateIndicatorWidth() {
        let tableWidth = $(".table").width(); // Get the width of the .table div
        $(".indicator").css("width", tableWidth); // Set the width of the indicator to match the .table div width
      }

      // Call the function initially to set the width of the indicator
      updateIndicatorWidth();

      // Call the function whenever the window is resized to update the width of the indicator
      $(window).on("resize", function () {
        updateIndicatorWidth();
      });
    });
  </script>
</body>

</html>